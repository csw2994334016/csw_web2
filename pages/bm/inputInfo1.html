---
layout: base_page
---
{% include common/fileInput.html %}
<div class="pos-absolute flex-row" style="top: 0; right: 0;bottom: 0;left: 0; overflow-y: scroll;overflow-x: hidden">
    <!--主Table-->
    <div id="mainDiv" class="p-15 w-full">
        <div class="form-horizontal bg-white r-5 m-b-15 p-t-10 p-r-10 p-b-1">
            <div class="form-group m-b-10 " style="margin-left: 0; margin-right: 0;">
                <label for="whId" class="col-sm-1 control-label">仓库</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="whId" name="whId" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择仓库">
                    </select>
                </div>
                <label for="zoneId" class="col-sm-1 control-label">仓区</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="zoneId" name="zoneId" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择仓区">
                    </select>
                </div>
                <label for="areaId" class="col-sm-1 control-label">储区</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="areaId" name="areaId" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择储区">
                    </select>
                </div>
                <label for="locId" class="col-sm-1 control-label">储位</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="locId" name="locId" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择储位">
                    </select>
                </div>
            </div>
            <div class="form-group" style="margin-left: 0; margin-right: 0;">
                <label for="sku1" class="col-sm-1 control-label">物料</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="sku1" name="sku1" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择物料名称-规格/型号">
                    </select>
                </div>
                <label for="startTime" class="col-sm-1 control-label">开始时间</label>
                <div class="col-sm-2" style="padding-right: 0;padding-left: 0;">
                    <input type="date" class="form-control h-30" name="startTime" id="startTime"
                           placeholder="请输入开始时间"/>
                </div>
                <label for="endTime" class="col-sm-1 control-label">结束时间</label>
                <div class="col-sm-2" style="padding-right: 0;padding-left: 0;">
                    <input type="date" class="form-control h-30" name="endTime" id="endTime"
                           placeholder="请输入结束时间"/>
                </div>
                <label class="col-sm-1 control-label"></label>
                <div class="col-sm-2" style="padding-right: 0;padding-left: 0;">
                    <button id="search" type="button" class="btn btn-primary">
                        <i class="glyphicon glyphicon-search"></i> 查询
                    </button>
                    <button id="reset1" type="button" class="btn btn-warning">
                        <i class="glyphicon glyphicon-remove-sign"></i> 重置
                    </button>
                </div>
            </div>
        </div>
        <div class="bg-white p-l-10 p-r-10 b-r-5">
            <table id="myTable" class="table table-hover"></table>
        </div>
        <div class="container" style="width: 100%;">
            <div id="toolbar">
                <button id="input" type="button" class="btn btn-default">
                    <i class="glyphicon glyphicon-hand-up"></i> 系统入库
                </button>
                <button id="import" type="button" class="btn btn-default">
                    <i class="glyphicon glyphicon-import"></i> 导入入库
                </button>
                <button id="deleteInputDetail" type="button" class="btn btn-default" disabled>
                    <i class="glyphicon glyphicon-trash"></i> 删除
                </button>
                <button id="export" type="button" class="btn btn-default">
                    <i class="glyphicon glyphicon-export"></i> 导出
                </button>
            </div>
        </div>
    </div>

    <!--系统入库Table-->
    <div id="allocateDiv" class="p-15 w-full tableDisplay pos-absolute"
         style="top: 0; right: 0;bottom: 0;left: 100%;z-index: 100">
        <div id="inputForm" class="form-horizontal bg-white r-5 m-b-15 p-t-10 p-r-10 p-b-1">
            <div class="form-group m-b-10" style="margin-left: 0; margin-right: 0;">
                <label for="sku" class="col-sm-1 control-label">物料</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="sku" name="sku" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择物料名称-规格/型号">
                    </select>
                </div>
                <label for="unitName" class="col-sm-1 control-label">单位</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="unitName" name="unitName" class="selectpicker form-control show-tick h-30"
                            data-live-search="true"
                            title="请选择单位">
                    </select>
                </div>
                <label for="supplierName" class="col-sm-1 control-label">供应商</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="supplierName" name="supplierName" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择供应商">
                    </select>
                </div>
                <label for="purchaseDept" class="col-sm-1 control-label">部门</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="purchaseDept" name="purchaseDept"
                           placeholder="请输入采购部门"/>
                </div>
            </div>
            <div class="form-group m-b-10" style="margin-left: 0; margin-right: 0;">
                <label for="purchaser" class="col-sm-1 control-label">采购人</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="purchaser" name="purchaser" placeholder="请输入采购人"/>
                </div>
                <label for="receiver" class="col-sm-1 control-label">验收人</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="receiver" name="receiver" placeholder="请输入验收人"/>
                </div>
                <label for="amount" class="col-sm-1 control-label">数量</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="amount" name="amount" placeholder="请输入数量"/>
                </div>
                <label for="unitPrice" class="col-sm-1 control-label">单价</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="unitPrice" name="unitPrice" placeholder="请输入单价"/>
                </div>
            </div>
            <div class="form-group m-b-10" style="margin-left: 0; margin-right: 0;">
                <label for="totalPrice" class="col-sm-1 control-label">总价</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <input type="text" class="form-control h-30" id="totalPrice" name="totalPrice" placeholder="请输入总价"/>
                </div>
                <label for="whName" class="col-sm-1 control-label">仓库</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="whName" name="whName" class="selectpicker form-control show-tick h-30"
                            data-live-search="true"
                            title="请选择仓库">
                    </select>
                </div>
                <label for="locName" class="col-sm-1 control-label">储位</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <select id="locName" name="locName" class="selectpicker form-control show-tick h-30"
                            data-live-search="true" title="请选择6位的储位代码">
                    </select>
                </div>
                <label for="remark" class="col-sm-1 control-label">备注</label>
                <div class="col-sm-2" style="padding-right: 0; padding-left: 0;">
                    <textarea class="form-control h-30" rows="1" id="remark" name="remark"
                              placeholder="请输入备注（200字内）"></textarea>
                </div>
            </div>
        </div>
        <div class=" bg-white p-l-10 p-r-10 b-r-5">
            <table id="inputTable" class="table table-hover"></table>
        </div>
        <div class="container" style="width: 100%;">
            <div id="inputToolbar">
                <button id="return1" type="button" class="btn btn-default">
                    <i class="glyphicon glyphicon-arrow-left"></i> 返回
                </button>
                <button id="addToTable" type="button" class="btn btn-primary">
                    <i class="glyphicon glyphicon-plus"></i> 添加
                </button>
                <button id="reset" type="button" class="btn btn-warning">
                    <i class="glyphicon glyphicon-cog"></i> 重置
                </button>
                <button id="delete" type="button" class="btn btn-default" disabled>
                    <i class="glyphicon glyphicon-trash"></i> 删除
                </button>
                <button id="inputSaveBnt" type="button" class="btn btn-primary">
                    <i class="glyphicon glyphicon-floppy-disk"></i> 保存
                </button>
            </div>
        </div>
    </div>

    <!--导入入库Table-->
    <div id="giveBackDiv" class="p-15 w-full tableDisplay pos-absolute"
         style="top: 0; right: 0;bottom: 0;left: 100%;z-index: 200">
        <div class="bg-white p-l-10 p-r-10 b-r-5">
            <table id="importTable" class="table table-hover"></table>
        </div>
        <div class="container" style="width: 100%;">
            <div id="importToolbar" class="flex-row">
                <button id="return2" type="button" class="btn btn-default" data-toggle="modal">
                    <i class="glyphicon glyphicon-arrow-left"></i> 返回
                </button>
                <div class="m-l-5 m-r-5" style="margin-top: -2px">
                    <input id="fileImport" type="file" name="filename">
                </div>
                <button id="importSaveBnt" type="button" class="btn btn-primary">
                    <i class="glyphicon glyphicon-floppy-disk"></i> 保存
                </button>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    var Table = {
        api: '/api/bm/inputDetails',
        tableId: "myTable",
        toolbarId: "toolbar",
        bsTable: null,
        bsModal: null
    };
    Table.initColumn = function () {
        var columns = [
            {field: 'state1', checkbox: true, align: 'center', valign: 'middle'},
            {title: 'ID', field: 'id', align: 'center', visible: false},
            {title: '入库单号', field: 'inputNo', align: 'center'},
            {title: '物料名称', field: 'skuDesc', align: 'center'},
            {title: '规格/型号', field: 'spec', align: 'center'},
            {title: '单位', field: 'unitName', align: 'center'},
            {title: '数量', field: 'amount', align: 'center'},
            {title: '单价', field: 'unitPrice', align: 'center'},
            {title: '总价', field: 'totalPrice', align: 'center'},
            {title: '采购部门', field: 'purchaseDept', align: 'center'},
            {title: '采购人', field: 'purchaser', align: 'center'},
            {
                title: '验收人',
                field: 'receiver',
                align: 'center',
                cellStyle: BSTable.prototype.formatTableCell
            },
            {title: '供应商', field: 'supplierName', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
            {title: '库房', field: 'whName', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
            {title: '储位代码', field: 'locName', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
            {
                title: '状态',
                field: 'state',
                align: 'center',
                formatter: BSTable.prototype.stateFormatter,
                cellStyle: BSTable.prototype.formatTableCell
            },
            {title: '入库时间', field: 'createTime', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
            {title: '备注', field: 'remark', align: 'center', cellStyle: BSTable.prototype.formatTableCell}
        ];
        return columns;
    };

    var columns = [
        {field: 'state', checkbox: true, align: 'center', valign: 'middle'},
        {title: '物料编号', field: 'sku', align: 'center'},
        {title: '物料名称', field: 'skuDesc', align: 'center'},
        {title: '规格/型号', field: 'spec', align: 'center'},
        {title: '类别', field: 'categoryName', align: 'center'},
        {title: '单位', field: 'unitName', align: 'center'},
        {title: '单价', field: 'unitPrice', align: 'center'},
        {title: '数量', field: 'amount', align: 'center'},
        {title: '总价', field: 'totalPrice', align: 'center'},
        {title: '采购部门', field: 'purchaseDept', align: 'center'},
        {title: '采购人', field: 'purchaser', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
        {title: '验收人', field: 'receiver', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
        {title: '供应商', field: 'supplierName', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
        {title: '库房', field: 'whName', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
        {
            title: '储位代码', field: 'locName', align: 'center',
            cellStyle: BSTable.prototype.formatTableCell,
            editable: {
                type: 'text',
                title: '请填写储位代码',
                validate: function (v) {
                    if (!v) return '储位代码不能为空';
                }
            }
        },
        {title: '备注', field: 'remark', align: 'center', cellStyle: BSTable.prototype.formatTableCell},
        {title: '批次号', field: 'batchNo', align: 'center', visible: false}
    ];
    var InputTable = {
        api: '',
        tableId: "inputTable",
        toolbarId: "inputToolbar",
        bsTable: null,
        bsModal: null
    };
    InputTable.initColumn = function () {
        return columns;
    };
    var ImportTable = {
        api: '',
        tableId: "importTable",
        toolbarId: "importToolbar",
        bsTable: null,
        bsModal: null
    };
    ImportTable.initColumn = function () {
        return columns;
    };

    //执行方法
    $(function () {

        var fields = ['sku', 'categoryName', 'unitName', 'supplierName', 'purchaseDept', 'purchaser', 'receiver', 'amount', 'unitPrice', 'totalPrice', 'whName', 'locName', 'remark'];
        var bsModal = new BSModal(Table.api);
        bsModal.setFields(fields);
        bsModal.setModal('inputModal', 'inputForm', 'inputSaveBnt', 'id');
        bsModal = bsModal.init();
        var bsTable = new BSTable(Table.tableId, Table.toolbarId, CSW.getUrl(Table.api), Table.initColumn());
        bsTable = bsTable.init();
        bsTable.tbInstance.on('check.bs.table uncheck.bs.table ' +
            'check-all.bs.table uncheck-all.bs.table', function () {
            $('#deleteInputDetail').prop('disabled', !bsTable.tbInstance.bootstrapTable('getSelections').length);
        });

        var inputTable = new BSTable(InputTable.tableId, InputTable.toolbarId, InputTable.api, InputTable.initColumn());
        inputTable.setOnEditableSave(function () {

        });
        inputTable = inputTable.init();
        inputTable.tbInstance.on('check.bs.table uncheck.bs.table ' +
            'check-all.bs.table uncheck-all.bs.table', function () {
            $('#delete').prop('disabled', !inputTable.tbInstance.bootstrapTable('getSelections').length);
        });

        var importTable = new BSTable(ImportTable.tableId, ImportTable.toolbarId, ImportTable.api, ImportTable.initColumn());
        importTable.setOnEditableSave(function () {

        });
        importTable = importTable.init();

        $("#input").click(function () {
            $("#locName").selectpicker('val', '');
            bsModal.clearForm();
            inputTable.tbInstance.bootstrapTable('removeAll');
            //物料下拉框
            $("#sku").empty();
            var ajax = new $ax('/api/basic/products', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#sku");
                    for (var i = 0; i < items.length; i++) {
                        var sku_categoryName = items[i].sku + "-" + items[i].category.name;
                        var skuDesc_spec = items[i].skuDesc + "-" + items[i].spec;
                        select.append("<option value='" + sku_categoryName + "'>" + skuDesc_spec + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax.type = "get";
            ajax.start();
            //单位下拉框
            $("#unitName").empty();
            ajax = new $ax('/api/basic/units', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#unitName");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].unitName + "'>" + items[i].unitName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax.type = "get";
            ajax.start();
            //供应商下拉框
            $("#supplierName").empty();
            ajax = new $ax('/api/basic/suppliers', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#supplierName");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].supplierName + "'>" + items[i].supplierName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax.type = "get";
            ajax.start();
            //库房下拉框
            $("#whName").empty();
            ajax = new $ax('/api/basic/warehouses', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#whName");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].whName + "'>" + items[i].whName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax.type = "get";
            ajax.start();
            show1();
        });
        //储位下拉框
        $('#whName').change(function () {
            var whName = $('#whName').val();
            $("#locName").empty();
            var ajax1 = new $ax('/api/basic/locs/warehouse', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#locName");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].locName + "'>" + items[i].locName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax1.set("whName", whName);
            ajax1.type = "POST";
            ajax1.start();
        });
        //数量框离开
        $('#amount').blur(function () {
            var amount = $('#amount').val();
            if (CSW.validatePositiveFloatNum(amount)) {
                var unitPrice = $('#unitPrice').val();
                if (CSW.validatePositiveFloatNum(unitPrice)) {
                    var tol = parseFloat(amount) * parseFloat(unitPrice);
                    $('#totalPrice').val(tol);
                }
            } else {
                CSW.error("数量只能是数字");
            }
        });
        //单价框离开
        $('#unitPrice').blur(function () {
            var unitPrice = $('#unitPrice').val();
            if (CSW.validatePositiveFloatNum(unitPrice)) {
                var amount = $('#amount').val();
                if (CSW.validatePositiveFloatNum(amount)) {
                    var tol = parseFloat(amount) * parseFloat(unitPrice);
                    $('#totalPrice').val(tol);
                }
            } else {
                CSW.error("单价只能是数字");
            }
        });
        $('#addToTable').click(function () {
            bsModal.clearModalData();
            bsModal.collectModalData();
            var modalData = bsModal.modalData;
            var s = $('#sku').find("option:selected").text();
            var skuDesc_spec = String(s);
            modalData['skuDesc'] = skuDesc_spec.split('-')[0];
            modalData['spec'] = skuDesc_spec.split('-')[1];
            var sku_categoryName = String(modalData.sku);
            modalData['sku'] = sku_categoryName.split('-')[0];
            modalData['categoryName'] = sku_categoryName.split('-')[1];
            // console.log(modalData);
            //验证必要字段
            if (modalData.sku === "" || typeof modalData.categoryName === "undefined") {
                CSW.error("物料编号不可以为空");
            } else if (typeof modalData.skuDesc === "undefined"
                || typeof modalData.spec === "undefined") {
                CSW.error("物料名称-规格/类型不可以为空")
            } else if (modalData.unitName === "") {
                CSW.error("单位不可以为空");
            } else if (modalData.amount === "") {
                CSW.error("数量不可以为空");
            } else if (modalData.whName === "") {
                CSW.error("库房名称不可以为空");
            } else if (modalData.locName === "") {
                CSW.error("储位代码不可以为空");
            } else {
                var include = true;
                var items = inputTable.tbInstance.bootstrapTable('getData');
                for (var i in items) {
                    if (items[i].sku === modalData.sku) {
                        include = false;
                    }
                }
                if (include) {
                    inputTable.tbInstance.bootstrapTable('append', modalData);
                } else {
                    CSW.error("表格中存在该物料，请在原记录中修改");
                }
            }
        });
        $('#reset').click(function () {
            bsModal.clearForm();
            $('#sku').selectpicker('val', '');
            $('#unitName').selectpicker('val', '');
            $('#supplierName').selectpicker('val', '');
            $('#whName').selectpicker('val', '');
            $('#locName').selectpicker('val', '');
        });
        $('#delete').click(function () {
            var items = inputTable.getItemSelections();
            var skuDesc = [];
            for (var i in items) {
                skuDesc.push(items[i].skuDesc);
            }
            inputTable.tbInstance.bootstrapTable('remove', {field: 'skuDesc', values: skuDesc});
        });
        $('#inputSaveBnt').click(function () {
            var items = inputTable.getItemSelections();
            saveBnt(items, 'input');
        });
        $("#return1").click(function () {
            return1();
        });

        $("#import").click(function () {
            importTable.tbInstance.bootstrapTable('removeAll');
            show2();
        });
        initFileInput("fileImport", CSW.getUrl("/api/bm/inputDetails/upload"));
        $('#fileImport').on('fileuploaded', function (event, data, previewId, index) {
            var response = data.response;
            console.log(response);
            if (response.code === "0000") {
                importTable.tbInstance.bootstrapTable('append', response.data);
            } else if (response.code === "0002") {
                CSW.error(CSW.saveFail + response.msg);
            } else {
                CSW.error(CSW.unknowCode + response.code);
            }
        });
        $('#fileImport').on('fileerror', function (event, data, msg) {
            CSW.error(CSW.saveFail);
        });
        $('.fileinput-remove-button').click(function () {
            importTable.tbInstance.bootstrapTable('removeAll');
        });
        $('#importSaveBnt').click(function () {
            var items = importTable.getItemSelections();
            for (var i in items) {
                items[i]['inputType'] = "import";
            }
            saveBnt(items, 'import');
        });
        $("#return2").click(function () {
            return2();
        });

        $('#deleteInputDetail').click(function () {
            var ids = bsTable.getIdSelections();
            // console.log("ids: " + ids);
            if (ids.length >= 1) {
                var str = ids.length > 1 ? "注意是批量删除！" : "";
                CSW.confirm(CSW.confirmInfo + str, function (result) {
                    if (result) {
                        var objects = [];
                        for (var i in ids) {
                            var object = {};
                            object["id"] = parseInt(ids[i]);
                            objects.push(object);
                        }
                        // console.log("ids: " + objects);
                        var ajax = new $ax(Table.api + "/batch", function (data) {
                            if (data.code === "0000") {
                                CSW.success(CSW.deleteOk);
                                bsTable.refresh();
                            } else if (data.code === "0002") {
                                CSW.error(CSW.deleteFail + data.msg);
                            } else {
                                CSW.error(CSW.unknowCode + data.code);
                            }
                        }, function (data) {
                            CSW.error(CSW.requestFail + data.msg);
                        });
                        ajax.type = "DELETE";
                        ajax.data = objects;
                        ajax.start();
                    }
                });
            } else {
                CSW.info(CSW.selectTip);
            }
        });

        function saveBnt(items, inputType) {
            // console.log(items);
            if (items.length > 0) {
                var ajax = new $ax(Table.api, function (data) {
                    if (data.code === "0000") {
                        CSW.success(CSW.saveOk);
                        if ('import' === inputType) {
                            return2();
                        } else {
                            return1();
                        }
                        bsTable.refresh();
                    } else if (data.code === "0002") {
                        CSW.error(CSW.saveFail + data.msg);
                    } else {
                        CSW.error(CSW.unknowCode + data.code);
                    }
                }, function (data) {
                    CSW.error(CSW.requestFail + data.msg);
                });
                ajax.setData(items); //提交的Json数据对象
                ajax.type = "POST";
                ajax.start();
            }
        }

        function show1() {
            $("#allocateDiv").css("display", "block");
            setTimeout(function () {
                $("#allocateDiv").css("transform", "translate(-100%, 0%)");
            }, 300);
            setTimeout(function () {
                $("#mainDiv").addClass("display-none").removeClass('display-block');
            }, 600);
        }

        function show2() {
            $("#giveBackDiv").css("display", "block");
            setTimeout(function () {
                $("#giveBackDiv").css("transform", "translate(-100%, 0%)");
            }, 300);
            setTimeout(function () {
                $("#mainDiv").addClass("display-none").removeClass('display-block');
            }, 600);
        }

        function return1() {
            $("#allocateDiv").css("transform", "translate(0%, 0%)");
            setTimeout(function () {
                $("#mainDiv").addClass("display-block").removeClass('display-none');
            }, 100);
            setTimeout(function () {
                $("#allocateDiv").css("display", "none");
            }, 200);
        }

        function return2() {
            $("#giveBackDiv").css("transform", "translate(0%, 0%)");
            setTimeout(function () {
                $("#mainDiv").addClass("display-block").removeClass('display-none');
            }, 100);
            setTimeout(function () {
                $("#giveBackDiv").css("display", "none");
            }, 200);
        }

        //查询条件
        //库房下拉框
        $('#whId').empty();
        var ajax = new $ax('/api/basic/warehouses', function (data) {
            if (data.code === "0000") {
                var items = data.data;
                // console.log(items);
                var select = $("#whId");
                select.append("<option value='" + '' + "'>" + '' + "</option>");
                for (var i = 0; i < items.length; i++) {
                    select.append("<option value='" + items[i].id + "'>" + items[i].whName + "</option>");
                }
                select.selectpicker('val', '');
                select.selectpicker('refresh');
            } else if (data.code === "0002") {
                CSW.error(CSW.getFail + data.msg);
            } else {
                CSW.error(CSW.unknowCode + data.code);
            }
        }, function (data) {
            CSW.error(CSW.requestFail + data.msg);
        });
        ajax.type = "GET";
        ajax.start();
        //仓区下拉框
        $('#whId').change(function () {
            var whId = $('#whId').val();
            $("#zoneId").empty();
            var ajax1 = new $ax('/api/basic/zones/warehouse', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#zoneId");
                    select.append("<option value='" + '' + "'>" + '' + "</option>");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].id + "'>" + items[i].zoneName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax1.set("pwhId", whId);
            ajax1.type = "POST";
            ajax1.start();
        });
        //储区下拉框
        $('#zoneId').change(function () {
            var zoneId = $('#zoneId').val();
            $("#areaId").empty();
            var ajax1 = new $ax('/api/basic/areas/zone', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#areaId");
                    select.append("<option value='" + '' + "'>" + '' + "</option>");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].id + "'>" + items[i].areaName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax1.set("pzoneId", zoneId);
            ajax1.type = "POST";
            ajax1.start();
        });
        //储位下拉框
        $('#areaId').change(function () {
            var areaId = $('#areaId').val();
            $("#locId").empty();
            var ajax1 = new $ax('/api/basic/locs/area', function (data) {
                if (data.code === "0000") {
                    var items = data.data;
                    // console.log(items);
                    var select = $("#locId");
                    select.append("<option value='" + '' + "'>" + '' + "</option>");
                    for (var i = 0; i < items.length; i++) {
                        select.append("<option value='" + items[i].id + "'>" + items[i].locName + "</option>");
                    }
                    select.selectpicker('val', '');
                    select.selectpicker('refresh');
                } else if (data.code === "0002") {
                    CSW.error(CSW.getFail + data.msg);
                } else {
                    CSW.error(CSW.unknowCode + data.code);
                }
            }, function (data) {
                CSW.error(CSW.requestFail + data.msg);
            });
            ajax1.set("pareaId", areaId);
            ajax1.type = "POST";
            ajax1.start();
        });
        //物料信息下拉框
        $('#sku1').empty();
        ajax = new $ax('/api/basic/products', function (data) {
            if (data.code === "0000") {
                var items = data.data;
                // console.log(items);
                var select = $("#sku1");
                select.append("<option value='" + '' + "'>" + '' + "</option>");
                for (var i = 0; i < items.length; i++) {
                    var skuDesc_spec = items[i].skuDesc + "-" + items[i].spec;
                    select.append("<option value='" + items[i].sku + "'>" + skuDesc_spec + "</option>");
                }
                select.selectpicker('val', '');
                select.selectpicker('refresh');
            } else if (data.code === "0002") {
                CSW.error(CSW.getFail + data.msg);
            } else {
                CSW.error(CSW.unknowCode + data.code);
            }
        }, function (data) {
            CSW.error(CSW.requestFail + data.msg);
        });
        ajax.type = "GET";
        ajax.start();

        $('#reset1').click(function () {
            $('#whId').selectpicker('val', '');
            $('#zoneId').selectpicker('val', '');
            $('#areaId').selectpicker('val', '');
            $('#locId').selectpicker('val', '');
            $('#sku1').selectpicker('val', '');
            $('#startTime').val('');
            $('#endTime').val('');
        });

        $("#search").click(function () {
            var queryData = {};
            queryData['whId'] = $('#whId').val();
            queryData['zoneId'] = $('#zoneId').val();
            queryData['areaId'] = $('#areaId').val();
            queryData['locId'] = $('#locId').val();
            queryData['sku'] = $('#sku1').val();
            queryData['startTime'] = $('#startTime').val();
            queryData['endTime'] = $('#endTime').val();
            bsTable.refresh({query: queryData});
            bsTable.setRefreshParams({query: queryData});
        });

    });

    function initFileInput(ctrlName, uploadApi) {
        var control = $('#' + ctrlName);
        control.fileinput({
            language: 'zh', //设置语言
            uploadUrl: uploadApi, //上传的地址
            showPreview: false,
            showUpload: true, //是否显示上传按钮
            showCaption: false,//是否显示标题
            browseClass: "btn btn-primary", //按钮样式
            previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
            allowedFileExtensions: ['xls', 'xlsx'], //接收的文件后缀
            enctype: 'multipart/form-data',
            validateInitialCount: true,
            ajaxSettings: {
                xhrFields: {withCredentials: true},
                crossDomain: this.crossDomain
            }
        });
    }

</script>
